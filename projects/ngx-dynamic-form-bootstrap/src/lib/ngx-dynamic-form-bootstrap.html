<form #ngForm="ngForm" [formGroup]="dynamicFormGroup" class="needs-validation" (ngSubmit)="submit()">
    
    <!-- Bootstrap Form Group Starts -->
    <div class="row">

        @for (field of form.formGroup; track field.formControlName; let i = $index) { 

             <div class="col-md-{{ field.column }}">

                <div class="form-group">

                    @if (field.label) {
                        <label [for]="field.formControlName">
                            
                            {{ field.label }} 

                            @if (field.required) {
                                <span style="color: #dc3545;">*</span>
                            }

                        </label>
                    }

                    <div class="input-group w-100">

                        @if (field.prefix) {
                            <div class="input-group-prepend">
                                <span class="input-group-text"> {{ field.prefix }} </span>
                            </div>
                        }

                        @switch (field.fieldType) {

                            @case ('input') {
                                <input
                                    [autocomplete]="field.autoComplete ? 'on' : 'new-password'"
                                    class="form-control" 
                                    [placeholder]="field.placeholder" 
                                    [formControlName]="field.formControlName" 
                                    [type]="field && field.inputType ? field.inputType: 'text'"
                                    [id]="field.formControlName"
                                    [required]="field.required"
                                    [class]="field.customClass"
                                    [maxLength]="field.maxLength ? field.maxLength : 1000000"
                                    (keyup)="onInputChange($event, field.formControlName, i)"
                                >
                            }
                            @case ('textarea') {
                                <textarea 
                                    class="form-control"
                                    [placeholder]="field.placeholder" 
                                    [formControlName]="field.formControlName"
                                    [id]="field.formControlName"
                                    [required]="field.required"
                                    [class]="field.customClass"
                                    [maxLength]="field.maxLength ? field.maxLength : 100000"
                                    (keyup)="onInputChange($event, field.formControlName, i)"
                                ></textarea>
                            }
                            @case ('select') {
                                <select 
                                    class="form-control"
                                    [formControlName]="field.formControlName"
                                    [id]="field.formControlName"
                                    [required]="field.required"
                                    [class]="field.customClass"
                                >

                                    @if (field.placeholder) {
                                        <option selected disabled value="">
                                            {{ field.placeholder }}
                                        </option>
                                    }

                                    @for (option of field.options; track option.value) {
                                        <option [value]="option.value" [disabled]="option.disabled">{{ option.displayValue }}</option>
                                    }
          
                                </select>
                            }
                            @case ('multiselect') {
                                <select 
                                    #multiSelect
                                    [formControlName]="field.formControlName"
                                    [id]="field.formControlName"
                                    [required]="field.required"
                                    [class]="field.customClass"
                                    class="form-control selectpicker multi-select-field"
                                    [attr.multiple]="true"
                                    [attr.data-live-search]="true"
                                    [attr.data-actions-box]="true"
                                    [attr.data-selected-text-format]="'count > 3'"
                                    (change)="onSelectionChange($event)"
                                >

                                    @for (option of field.options; track option.value) {
                                        <option [value]="option.value" [disabled]="option.disabled">{{ option.displayValue }}</option>
                                    }

                                    @if (field.options && field.options.length === 0) { 
                                        <option  value="null" disabled>
                                        No options available
                                        </option>
                                    }

                                    @if (!field.options) {
                                        <option  value="null" disabled>
                                        No options available
                                        </option>
                                    }
                        
                                </select>
                            }
                            @case ('checkbox') {
      
                                @if (field.checkBox && field.checkBox.options && field.checkBox.options.length > 0) { 

                                    @for (box of field.checkBox.options; track box.checkboxValue; let c = $index) { 
                                        <div class="form-check" [ngClass]="{'form-check-inline': field.checkBox.style === 'inline'}">
                                            <input 
                                                class="form-check-input"
                                                [class]="field.customClass"
                                                type="checkbox" 
                                                [formControlName]="field.formControlName"
                                                [id]="field.formControlName + c"
                                                [value]="box.checkboxValue"
                                                [name]="field.formControlName"
                                                [required]="field.required"
                                            >
                                            <label class="form-check-label" [for]="field.formControlName + c">
                                                {{ box.checkboxValue }}
                                            </label>
                                        </div>
                                    }

                                }
  
                            }
                            @case ('radioButton') {

                                @if (field.radioButtons && field.radioButtons.options && field.radioButtons.options.length > 0) { 

                                    @for (buttons of field.radioButtons.options; track buttons.checkboxValue; let r = $index) { 
                                        <div class="form-check" [ngClass]="{'form-check-inline': field.radioButtons.style === 'inline'}">
                                            <input 
                                                class="form-check-input"
                                                [class]="field.customClass"
                                                type="radio" 
                                                [formControlName]="field.formControlName"
                                                [id]="field.formControlName + r"
                                                [value]="buttons.checkboxValue"
                                                [name]="field.formControlName"
                                                [required]="field.required"
                                            >
                                            <label class="form-check-label" [for]="field.formControlName + r">
                                                {{ buttons.checkboxValue }}
                                            </label>
                                        </div>
                                    }
                                }

                            }
                            @case ('file') {
                                <div class="custom-file">
                       
                                    <input 
                                        type="file" 
                                        class="custom-file-input"
                                        [formControlName]="field.formControlName" 
                                        [id]="field.formControlName"
                                        [required]="field.required"
                                        [class]="field.customClass"
                                        [accept]="field.fileTypeValidation ? field.fileTypeValidation.allowedType : '*'"
                                        (change)="onFileChange($event, i)"
                                        [multiple]="field.multipleFile"
                                    >
                                    
                                    <label class="custom-file-label" [for]="field.formControlName">{{ field.placeholder }}</label>

                                    @if (filesToUpload.length > 0) { 
                                        @for (file of filesToUpload; track file.fileName; let index = $index) { 

                                            <div class="file-layout">
                                                <div class="file-details">
                                                    <div class="file-name">{{ file.fileName }}</div>
                                                    <div class="file-stats">
                                                        <span class="value">{{ file.fileSize }}</span>
                                                        <div class="dot"></div>
                                                        <span class="value">{{ file.fileType }}</span>
                                                    </div>
                                                </div>
                                                <div class="file-action">
                                                    <button class="btn delete-btn" (click)="deleteFile(index)">Delete</button>
                                                </div>
                                            </div>

                                        }
                                    }

                                </div>
                            }

                            @default {
                                <div>Unsupported field type</div>
                            }
                        }

                        @if (field.suffix) { 
                            <div class="input-group-append">
                                <span class="input-group-text"> {{ field.suffix }} </span>
                            </div>
                        }

                    </div>

                    @if (hasError(field.formControlName, field.required ? 'required' : '') && ngForm.submitted) {
                        <small class="form-text error-field text-muted">
                            {{ field.requiredErrorMessage ? field.requiredErrorMessage : 'Please enter ' + field.label }}
                        </small>
                    }

                    @if (hasError(field.formControlName, field.validation.patternName)) {
                        <small class="form-text error-field text-muted">
                            {{ field.validation.message }}
                        </small>
                    }

                    @if (field.hint) { 
                        <small class="form-text text-muted">{{ field.hint }}</small>
                    }

                    @if (field.displayMaxLength) { 
                        <small class="form-text text-muted float-right">
                            {{ formDetails.formGroup[i].value ? formDetails.formGroup[i].value.length : 0 }} / {{ field.maxLength }}
                        </small>
                    }


                </div>

             </div>

        }

    </div>
    <!-- Bootstrap Form Group Ends -->

    <!-- Button -->
    <button type="submit" class="btn" [class]="form.style.buttonStyle.class">{{ form.style.buttonStyle.buttonName }}</button>
    
</form>
